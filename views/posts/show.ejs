<%- include("../partials/header") %>

<main class="posts-show">
<div class="post-body">
	<div class= "post-img">
		<img src="http://localhost:4000/<%= post.image%>" alt="<%= post.caption %>">
	</div>

	<div class="post-desc">
		<ul style="list-style: none;">
			<li>Caption: <%= post.caption %></li>
			<li>#Tag: <%= post.tag.name %></li>
			<li>Author: <% post.user.name %></li>
		</ul>
	</div>
</div>

<div class="comments">
	<h4>Comments</h4>
    <% if (post.comments.length) { %>
        <% post.comments.forEach(comment => { %>
            <p><%= comment.user.name %>: <%= comment.content %></p>
			<% if (loginUser && loginUser_id === comment.user._id) { %>
				<a href="/comments/<%=comment._id%>/edit">Edit</a>
				<form action="/comments/<%= comment._id %>?_method=DELETE" method="POST">
					<input class="delete-comment-btn" type="submit" value="Delete" />
				</form>
			<% }%>
            
        <% }); %>
    <% } %>

    <% if (loginUser) { %>
    <form action="/posts/<%=post._id%>/comments" method="POST">
        <div class="form-group">
			<label><%=loginUser.name%>:</label>
			<input type="text" name="content" placeholder="Leave a comment">
		</div>
		
		<div class="form-group">
			<select name="post">
				<option value="<%=post._id%>"></option>
				</select>
		</div>
        
		<div class="form-group">
			<select name="user" id="">
                <option value="<%=loginUser._id%>"><%=loginUser.name%></option>
                </select>
		</div>
            
        <input class="post-submit-btn" type="submit" value="Post">
    </form>
    <%}%>
</div>

    <% if (loginUser) { %>
		<% if ( `${post.user._id}` === `${loginUser._id}`) { %>
			<a href="/posts/<%=post._id%>/edit">Edit Post</a>
			<form action="/posts/<%=post._id%>?_method=DELETE" method="POST">
				<input type="submit" value="Delete Post">
			</form>
		<%}%>
	<%}%>
</main>
</body>
</html>


